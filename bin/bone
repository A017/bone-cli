#!/usr/bin/env node

'use strict';

var fs = require('fs');
var path = require('path');

function getBoneFile() {
	var commandDir = path.resolve('./'),
		execuDir;

	commandDir = commandDir.split(path.sep);
	
	while(commandDir.length > 1) {
		execuDir = path.join(commandDir.join(path.sep), 'bonefile.js');

		if(fs.existsSync(execuDir)) {
			return execuDir;
		}
		commandDir.pop();
	}
	return false;
}

var bonefile = getBoneFile();

if(bonefile) {
	var boneCli = require('../index.js');
	var bone = boneCli.setupBone(path.dirname(bonefile));
	require(bonefile);
	bone.setup(path.dirname(bonefile));
	var commander = boneCli.commander;

	if(process.env.BONE_TASK) {
		require('../task.js').runCP();
	} else if(!process.argv.slice(2).length) {
		commander.outputHelp();
	} else {
		commander.parse(process.argv);
	}
} else {
	console.log('  Fatal error: Unable to find bonefile.js file.');
}